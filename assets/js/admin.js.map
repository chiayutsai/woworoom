{"version":3,"sources":["admin.js"],"names":["token","orderList","document","querySelector","deleteAllOrder","data","orderInit","axios","get","headers","then","response","orders","console","log","renderOrder","d3Data","orderStr","forEach","item","millisecond","Number","createdAt","date","Date","day","getFullYear","getMonth","getDay","product","products","productName","status","str","title","paid","id","user","name","tel","address","email","innerHTML","updateOrder","obj","put","alert","addEventListener","e","preventDefault","orderPaid","target","getAttribute","paidID","orderID","d3List","d3","d3Obj","d3Chart","d3Final","otherPrice","push","undefined","quantity","price","key","Object","keys","sort","a","b","length","i","arr","renderC3","color","chartColor","index","chart","c3","generate","bindto","type","columns","colors"],"mappings":"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","file":"admin.js","sourcesContent":["const token = 'I6cceP30vTfOjRgycyamdsXAFtY2';\nconst orderList = document.querySelector('.orderPage-table');\nconst deleteAllOrder = document.querySelector('.discardAllBtn')\nlet data;\n\n\nfunction orderInit() {\n    axios.get('https://hexschoollivejs.herokuapp.com/api/livejs/v1/admin/chiayu/orders',\n        {\n            headers: {\n                'Authorization': token\n            }\n        })\n        .then(function (response) {\n            data = response.data.orders;\n            console.log(data)\n            renderOrder()\n            d3Data()\n        });\n\n}\nfunction renderOrder() {\n    let orderStr = '';\n    data.forEach(function (item) {\n        let millisecond = Number(item.createdAt + \"000\");\n        let date = new Date(millisecond);\n        let day = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDay() + 1}`\n        let product = item.products\n        let productName = '';\n        let status;\n        product.forEach(function (item) {\n            let str = `<p>${item.title}</p>`\n            productName += str\n\n        })\n        if (item.paid == false) {\n            status = '未處理'\n        } else {\n            status = '已處理'\n        }\n\n        let str = ''\n        str = `  <tr>\n        <td>${item.id}</td>\n        <td>\n            <p>${item.user.name}</p>\n            <p>${item.user.tel}</p>\n        </td>\n        <td>${item.user.address}</td>\n        <td>${item.user.email}</td>\n        <td>\n           ${productName}\n        </td>\n        <td>${day}</td>\n        <td class=\"orderStatus\">\n            <a href=\"#\" data-paid=\"${item.paid}\" data-id= \"${item.id}\">${status}</a>\n        </td>\n        <td>\n            <input type=\"button\" class=\"delSingleOrder-Btn\" value=\"刪除\" data-delete= \"${item.id}\">\n        </td>\n    </tr>`\n        orderStr += str\n    })\n    orderList.innerHTML = ` <thead>\n    <tr>\n        <th>訂單編號</th>\n        <th>聯絡人</th>\n        <th>聯絡地址</th>\n        <th>電子郵件</th>\n        <th>訂單品項</th>\n        <th>訂單日期</th>\n        <th>訂單狀態</th>\n        <th>操作</th>\n    </tr>\n</thead>${orderStr}`\n}\nfunction updateOrder(obj) {\n    axios.put('https://hexschoollivejs.herokuapp.com/api/livejs/v1/admin/chiayu/orders', obj, {\n        headers: {\n            'Authorization': token\n        }\n    })\n        .then(function (response) {\n            orderInit()\n            alert('訂單狀態已修改')\n\n        });\n}\n//修改訂單\norderList.addEventListener('click', function (e) {\n    e.preventDefault();\n    let orderPaid = e.target.getAttribute('data-paid');\n    let paidID = e.target.getAttribute('data-id');\n\n    if (orderPaid == null) {\n        return;\n    }\n    if (orderPaid == 'true') {\n        orderPaid = false;\n    } else {\n        orderPaid = true\n    }\n    console.log(orderPaid, paidID)\n    let obj = {\n        \"data\": {\n            \"id\": paidID,\n            \"paid\": orderPaid\n        }\n    }\n    updateOrder(obj)\n\n\n\n})\n//刪除訂單\ndeleteAllOrder.addEventListener('click', function () {\n    axios.delete('https://hexschoollivejs.herokuapp.com/api/livejs/v1/admin/chiayu/orders', {\n        headers: {\n            'Authorization': token\n        }\n    })\n        .then(function (response) {\n            console.log(response)\n            alert('訂單記錄已清空')\n            orderInit()\n        });\n})\norderList.addEventListener('click', function (e) {\n    e.preventDefault();\n    let orderID = e.target.getAttribute('data-delete');\n\n    if (orderID == null) {\n        return;\n    }\n    axios.delete('https://hexschoollivejs.herokuapp.com/api/livejs/v1/admin/chiayu/orders/' + orderID, {\n        headers: {\n            'Authorization': token\n        }\n    })\n        .then(function (response) {\n            console.log(response)\n            orderInit()\n        });\n})\norderInit()\n\n\nfunction d3Data() {\n    let d3List = [];\n    let d3 = {};\n    let d3Obj = [];\n    let d3Chart = [];\n    let d3Final = [];\n    let otherPrice = 0;\n    data.forEach(function (item) {\n        let product = item.products;\n        product.forEach(function (item) {\n            d3List.push(item);\n        })\n\n    })\n    d3List.forEach(function (item) {\n        if (d3[item.title] == undefined) {\n            d3[item.title] = item.quantity * item.price;\n\n        } else {\n            d3[item.title] += item.quantity * item.price;\n        }\n    })\n    let key = Object.keys(d3);\n    key.forEach(function (item) {\n        let obj = {};\n        obj['product'] = item;\n        obj['price'] = d3[item]\n        d3Obj.push(obj)\n    })\n    d3Obj.sort(function (a, b) {\n        return b['price'] - a['price'];\n    });\n    if (d3Obj.length > 3) {\n        for (let i = 0; i < 3; i++) {\n            d3Chart.push(d3Obj[i])\n        }\n        for (let i = 3; i < d3Obj.length; i++) {\n            otherPrice += d3Obj[i].price;\n        }\n        d3Chart.push({\n            product: '其他',\n            price: otherPrice\n        })\n    } else {\n        d3Obj.forEach(function (item) {\n            d3Chart.push(item)\n        })\n    }\n    d3Chart.forEach(function (item) {\n        let arr = [];\n        arr.push(item.product, item.price);\n        d3Final.push(arr)\n    })\n    renderC3(d3Final)\n}\n\nfunction renderC3(data) {\n    let color = [\"#DACBFF\", \"#9D7FEA\", \"#5434A7\", \"#301E5F\"]\n    let chartColor = {};\n    data.forEach(function (item, index) {\n        chartColor[item[0]] = color[index]\n    })\n    let chart = c3.generate({\n        bindto: '#chart',\n        data: {\n            type: \"pie\",\n            columns: data,\n            colors: chartColor\n        },\n    });\n}"]}